<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>관리자 — 로그인 기록</title>
<style>
  body{margin:0;font-family:system-ui,Arial,Helvetica,sans-serif;background:#071024;color:#e6eef8;padding:20px}
  .wrap{max-width:980px;margin:0 auto}
  h1{font-size:20px}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{border:1px solid rgba(255,255,255,0.06);padding:8px;text-align:left;font-size:13px}
  .note{color:#9aa6bf;font-size:13px;margin-top:8px}
  button{padding:8px 12px;border-radius:8px;border:0;background:#3b82f6;color:white;cursor:pointer;margin-right:8px}
</style>
</head>
<body>
  <div class="wrap">
    <h1>관리자: 로그인 기록</h1>
    <div id="status" class="note"></div>
    <div style="margin-top:12px">
      <button id="export">CSV로 내보내기</button>
      <button id="clear">기록 전체 삭제</button>
      <a href="index.html" style="color:inherit;margin-left:12px">메인으로</a>
    </div>
    <table id="tbl" style="display:none">
      <thead><tr><th>시간</th><th>이메일</th><th>동작</th><th>메모</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

<script src="app.js"></script>
<script>
function showStatus(text){ document.getElementById('status').textContent = text; }
const adminCheck = app_is_admin();
if(!adminCheck.isAdmin){
  showStatus('접근 불가: 관리자 권한이 필요합니다.');
  // Optionally show login link
} else {
  showStatus('관리자 인증됨: ' + adminCheck.user.email);
  const tbl = document.getElementById('tbl');
  const tbody = tbl.querySelector('tbody');
  const records = app_get_records();
  if(records.length === 0){ showStatus('기록이 없습니다.'); }
  tbl.style.display = 'table';
  records.slice().reverse().forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.time}</td><td>${r.email}</td><td>${r.action}</td><td>${r.note||''}</td>`;
    tbody.appendChild(tr);
  });

  document.getElementById('export').addEventListener('click', ()=>{
    const csv = app_records_to_csv(records);
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'login_records.csv';
    a.click();
    URL.revokeObjectURL(url);
  });

  document.getElementById('clear').addEventListener('click', ()=>{
    if(!confirm('기록을 모두 삭제하시겠습니까?')) return;
    app_clear_records();
    tbody.innerHTML = '';
    showStatus('기록 삭제됨');
  });
}
</script>
</body>
</html>
